# 项目规范

## 要求
- 所有列入该规范的要求除非**特殊标注**否则强制执行
- 该规范允许修改，修改需按照**DECISION.md**的规则进行

## 具体规范
### 编码规范Rust
1. 所有**错误处理**例如`Option`和`Result`不准使用`unwrap()`和`expect()`解包，必须进行**模式匹配**
2. 禁止使用`unreachable!()`宏敷衍**模式匹配**，必须输出**错误信息**
3. 不许捕获`panic`，需**合理预防**
4. 不许使用`panic`进行错误处理
5. 每个业务函数必须配备**测试**和**API文档**并且经过**Clippy**检查无警告，**例外情况见6条**
6. **Clippy误报的**，在代码旁进行**详细注释**后让`clippy`放宽，并且在**SPECIAL.md**里声明
7. 使用**thiserror**规范错误类型
8. 尽可能使用**不可变绑定**，如果没需要不使用**mut修饰**
9. 不和**Rust借用检查器**斗争，特殊情况**详细注释**并且在**SPECIAL.md**里声明
### 编码规范Vue/TypeScript
1. **禁止使用`any`类型**，特殊情况需在SPECIAL.md声明
2. **组件必须使用`<script setup lang="ts">`语法**
3. **状态管理统一使用Pinia**，禁止组件间直接传递复杂状态
4. **Tauri命令调用必须封装为函数**
5. **样式方案统一使用UnoCSS**，禁止混用CSS方案
6. **每个Vue组件必须包含**: 
   - Props类型定义
   - 基本组件测试（至少1个测试用例）
   - 组件用途的文档注释
7. **不许使用**`as unknown as target`类型断言，例外放入**SPECIAL.md**
### 编码规范通用
1. 一个函数**只做一件事**，禁止超过**200行**，特殊情况**详细注释**并且在**SPECIAL.md**里声明
2. **模块化**设计，严禁**鱼龙混杂**
3. 每个函数**配备注释**，非前端函数**配备测试**
4. 不和**语言规则**斗争，特殊情况**详细注释**并且在**SPECIAL.md**里声明
### 决策规范
1. 重大决策**写入DECISION.md**中，详见**2条**
2. 重大决策：**工具链转换**、**更改指定文档如本文档**、**其他规定的特殊情况**
3. 写入后**进行评估**，成功则**2天后重新评估**，依旧成功**2天后最终评估**，通过则采用
4. 写入时列清**优势**与**代价**
5. 在**1.0.0版本**发布前，不进行**任何新的重写**
6. 决策**评估失败后**不删除
### 尝鲜规范
1. 可以在**独立目录**中尝鲜，例如**学习新语言**、**尝试新工具链**等
2. 不允许**复制代码**进本项目，除非**Clippy**检查通过
3. 不影响**主项目及其他项目进度**
### 备份规范
1. 不改变系统**定时备份机制**
2. 使用Git**进行版本控制**，严禁**删除版本库重建**
3. 每天创建快照并保存至**移动硬盘**
4. 每天结束确保**所有分支同步到Github**
### SPECIAL结构要求
每个例外必须包含：
```markdown
# [文件名]:[行号] - [规则编号]
**日期**: YYYY-MM-DD
**违反规则**: STANDARD.md第X条第X款
**详细原因**: 
**解决方案**: 
**预计修复时间**: 
**负责人**: [你的名字]
```
### Git规范
1. 分阶段**开发**，每个阶段**设置单独分支**
2. `feature`分支：新功能**实现并测试后**合并
3. `dev`分支：新功能可以到达**beta标准**后合并
4. `main`分支：新功能**稳定后**合并
### 术语定义
1. **业务函数**: 包含核心业务逻辑、需要测试覆盖的公开函数
2. **工具函数**: 不包含业务逻辑的辅助函数，仍需测试但可降低覆盖率要求
3. **前端函数**: Vue组件中的组合式函数和工具函数
4. **测试用例**: 至少包含正常流程和1个异常流程的测试
### 测试规范
**基本组件测试必须包含**:
1. **渲染测试**: 验证组件能正常渲染
2. **Props测试**: 验证Props能正确影响组件行为  
3. **交互测试**: 验证至少1个用户交互能正常工作
4. **边界测试**: 验证异常情况下的行为 (如空数据、错误状态)

**示例不通过**:
```typescript
// ❌ 不通过: 过于简单
it('renders', () => {
  render(MyComponent)
})

// ✅ 通过: 有具体断言
it('should display user name when user prop is provided', () => {
  const wrapper = render(MyComponent, {
    props: { user: { name: '张三' } }
  })
  expect(wrapper.getByText('张三')).toBeInTheDocument()
})
```
