# Cards 类文档

## 概述

`Cards` 类用于管理存储在文件中的卡片数据，支持读取、写入和查询卡片信息。

## 导入

```dart
import 'dart:io';
```

## 构造函数

```dart
Cards({
  required this.filename,
  required this.cardname,
  required this.addnum,
})
```

### 参数说明

| 参数 | 类型 | 必需 | 描述 |
|------|------|------|------|
| `filename` | `String` | 是 | 存储卡片数据的文件路径 |
| `cardname` | `List<String>` | 是 | 所有可能的卡片名称列表 |
| `addnum` | `int` | 是 | 卡片的编号偏移量 |

## 属性

### `filename`
- **类型**: `String`
- **描述**: 存储卡片数据的文件路径

### `cardname`
- **类型**: `List<String>`
- **描述**: 所有卡片名称的列表，按索引顺序排列

### `addnum`
- **类型**: `int`
- **描述**: 用于调整卡片存储编号的偏移量

## 方法

### `get()`
从文件中读取卡片数据并返回有效的卡片名称列表。

```dart
List<String> get()
```

#### 处理流程
1. 检查文件是否存在，不存在则创建
2. 读取文件内容
3. 解析格式为 `/x/数字` 的数据
4. 去除重复项并应用偏移量
5. 映射到对应的卡片名称

#### 返回值
- 成功: 返回去重后的卡片名称列表
- 失败: 返回空列表

#### 错误处理
- 文件不存在时自动创建
- 解析错误时忽略无效数据
- 异常情况下返回空列表并打印错误信息

### `write(int index)`
将指定索引的卡片写入文件。

```dart
int write(int index)
```

#### 参数
- `index`: 卡片在 `cardname` 列表中的索引

#### 返回值
- `0`: 写入成功
- `-1`: 索引无效或写入失败

#### 处理流程
1. 验证索引范围
2. 确保文件存在
3. 以追加模式写入数据（格式：`,/x/{addnum + index}`）

### `getByIndex(int index)`
根据索引获取卡片名称。

```dart
String getByIndex(int index)
```

#### 参数
- `index`: 卡片索引

#### 返回值
- 有效索引: 对应的卡片名称
- 无效索引: 空字符串 `''`

## 数据存储格式

### 文件内容示例
```
/x/100,/x/101,/x/102
```

### 编码规则
1. 每条记录以逗号分隔
2. 每个记录格式为 `/x/{编号}`
3. 编号 = `addnum + 卡片索引`

## 使用示例

```dart
// 创建卡片管理器
final cards = Cards(
  filename: 'data/user_cards.txt',
  cardname: ['卡片A', '卡片B', '卡片C', '卡片D'],
  addnum: 100,
);

// 写入卡片
cards.write(2); // 写入"卡片C"，存储为"/x/102"

// 读取所有卡片
final myCards = cards.get(); // 返回['卡片C']

// 根据索引获取名称
final name = cards.getByIndex(2); // 返回"卡片C"
```

## 错误处理机制

1. **文件操作错误**: 自动捕获异常，返回安全值
2. **数据解析错误**: 忽略无效格式的数据
3. **索引越界**: 返回空值或错误码
4. **重复数据**: 自动去重

## 注意事项

1. 文件以追加模式写入，不会删除现有数据
2. 读取时会自动去重
3. `addnum` 用于防止编号冲突
4. 卡片索引从0开始
5. 文件名应包含完整路径

## 性能考虑

1. 使用同步方法，适用于小型数据文件
2. 读取时会进行去重处理
3. 每次写入都是追加操作，文件可能逐渐增大

## 扩展建议

1. 可考虑添加异步版本的方法
2. 可添加删除卡片的功能
3. 可考虑使用JSON格式增强可读性
4. 可添加批量操作接口